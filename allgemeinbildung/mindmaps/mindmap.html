<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dynamic Markmap</title>
  <style>
    body, html, #map { width: 100%; height: 100%; margin: 0; }
  </style>
</head>
<body>
  <svg id="map"></svg>

  <script type="module">
    import { Markmap } from 'https://cdn.jsdelivr.net/npm/markmap-view@0.13.3/dist/index.browser.js';

    async function loadMindmap() {
      const params = new URLSearchParams(location.search);
      const mapId = params.get('id') || 'mindmap1';
      const focusId = params.get('focus');

      // ðŸ‘‰ JSON files live in the "mindmaps/" folder next to this HTML
      const jsonPath = `mindmaps/${mapId}.json`;

      try {
        const res = await fetch(jsonPath);
        if (!res.ok) throw new Error(`HTTP ${res.status} loading ${jsonPath}`);
        const data = await res.json();

        // render
        const mm = Markmap.create('#map', { initialExpandLevel: 2 }, data);

        // if you passed ?focus=someNodeId, pan & highlight
        if (focusId) {
          // recursive search
          function findNode(node) {
            if (node.id === focusId) return node;
            for (const c of node.children || []) {
              const found = findNode(c);
              if (found) return found;
            }
          }
          const target = findNode(data);
          if (target) {
            await mm.centerNode(target);
            await mm.setHighlight(target);
          }
        }
      } catch (err) {
        document.body.innerHTML = `
          <div style="padding:2rem;font-family:sans-serif;color:#a00;">
            <h2>Failed to load mindmap</h2>
            <p>${err.message}</p>
          </div>`;
        console.error(err);
      }
    }

    loadMindmap();
  </script>
</body>
</html>
